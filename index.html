<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="zh-CN"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;在线字幕编辑器&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>* {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-sizing: border-box;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>body {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f5f5f5;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #333;</p>
<p class="p1"><span class="Apple-converted-space">            </span>line-height: 1.6;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.container {</p>
<p class="p1"><span class="Apple-converted-space">            </span>max-width: 1200px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0 auto;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 20px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>header {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #2c3e50;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 20px 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 30px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 2px 5px rgba(0,0,0,0.1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>h1 {</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 28px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.upload-section {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 30px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 2px 10px rgba(0,0,0,0.1);</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 30px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-align: center;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.file-input-wrapper {</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: inline-block;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.file-input-wrapper input[type=file] {</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">            </span>left: -9999px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.file-input-label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: inline-block;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 12px 30px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #3498db;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 5px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 16px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: background-color 0.3s;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.file-input-label:hover {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #2980b9;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.editor-section {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background: white;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 30px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 2px 10px rgba(0,0,0,0.1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.editor-header {</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>justify-content: space-between;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>flex-wrap: wrap;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 10px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.subtitle-item {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f8f9fa;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #e9ecef;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 5px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 15px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 15px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.3s;</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.subtitle-item:hover {</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 2px 5px rgba(0,0,0,0.1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.subtitle-item.editing {</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-color: #3498db;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #e3f2fd;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.time-display {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Courier New', monospace;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #666;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">            </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">            </span>gap: 10px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.time-input {</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-family: 'Courier New', monospace;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #ddd;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 5px 8px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 3px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 120px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.subtitle-text {</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>min-height: 50px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: 1px solid #ddd;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 5px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 16px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>resize: vertical;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: border-color 0.3s;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.subtitle-text:focus {</p>
<p class="p1"><span class="Apple-converted-space">            </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-color: #3498db;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.format-selector {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 20px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.format-selector label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-right: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.format-selector input[type="radio"] {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-right: 5px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.stats {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #f8f9fa;</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 15px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 5px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 20px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #666;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn {</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 8px 16px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 5px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>transition: all 0.3s;</p>
<p class="p1"><span class="Apple-converted-space">            </span>text-decoration: none;</p>
<p class="p1"><span class="Apple-converted-space">            </span>display: inline-block;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-primary {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #3498db;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-primary:hover {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #2980b9;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-success {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #27ae60;</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: white;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.btn-success:hover {</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: #229954;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.error-message {</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #e74c3c;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 5px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.success-message {</p>
<p class="p1"><span class="Apple-converted-space">            </span>color: #27ae60;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 5px;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>@media (max-width: 768px) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>.container {</p>
<p class="p1"><span class="Apple-converted-space">                </span>padding: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>.editor-header {</p>
<p class="p1"><span class="Apple-converted-space">                </span>flex-direction: column;</p>
<p class="p1"><span class="Apple-converted-space">                </span>align-items: stretch;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h1&gt;🎬 在线字幕编辑器&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="upload-section" id="uploadSection"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;h2&gt;上传字幕文件&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;p style="margin: 20px 0; color: #666;"&gt;支持 SRT、WEBVTT 和 TXT 格式&lt;/p&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="file-input-wrapper"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;input type="file" id="fileInput" accept=".srt,.vtt,.txt"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label for="fileInput" class="file-input-label"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>选择字幕文件</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="uploadError" class="error-message" style="display: none;"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="uploadSuccess" class="success-message" style="display: none;"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="editor-section" id="editorSection"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="editor-header"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;h2&gt;字幕编辑器&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;button class="btn btn-success" onclick="downloadSubtitles()"&gt;💾 下载字幕&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="format-selector"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="radio" name="format" value="srt" checked&gt; SRT 格式</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="radio" name="format" value="vtt"&gt; WEBVTT 格式</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;label&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;input type="radio" name="format" value="txt"&gt; 纯文本格式</p>
<p class="p1"><span class="Apple-converted-space">                </span>&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="stats" id="stats"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>字幕总数: &lt;span id="subtitleCount"&gt;0&lt;/span&gt; |<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>总时长: &lt;span id="totalDuration"&gt;00:00:00&lt;/span&gt; |</p>
<p class="p1"><span class="Apple-converted-space">                </span>已修改: &lt;span id="modifiedCount"&gt;0&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div id="subtitleContainer"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let subtitles = [];</p>
<p class="p1"><span class="Apple-converted-space">        </span>let modifiedCount = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 文件上传处理</p>
<p class="p1"><span class="Apple-converted-space">        </span>document.getElementById('fileInput').addEventListener('change', function(e) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const file = e.target.files[0];</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!file) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const fileName = file.name.toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">            </span>let format = 'srt';</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (fileName.endsWith('.vtt')) format = 'vtt';</p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (fileName.endsWith('.txt')) format = 'txt';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const reader = new FileReader();</p>
<p class="p1"><span class="Apple-converted-space">            </span>reader.onload = function(e) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const content = e.target.result;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>subtitles = parseSubtitles(content, format);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>displaySubtitles();</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('uploadSection').style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('editorSection').style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('uploadError').style.display = 'none';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('uploadSuccess').style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('uploadSuccess').textContent = '文件上传成功！';</p>
<p class="p2"><span class="Apple-converted-space">                    </span></p>
<p class="p1"><span class="Apple-converted-space">                    </span>// 设置格式选择器</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.querySelector(`input[name="format"][value="${format}"]`).checked = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('uploadError').style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>document.getElementById('uploadError').textContent = '解析文件失败: ' + error.message;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>};</p>
<p class="p1"><span class="Apple-converted-space">            </span>reader.readAsText(file);</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 解析字幕文件</p>
<p class="p1"><span class="Apple-converted-space">        </span>function parseSubtitles(content, format) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const lines = content.trim().split('\n');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const subs = [];</p>
<p class="p1"><span class="Apple-converted-space">            </span>let i = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (format === 'vtt') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// 跳过WEBVTT头部</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (lines[0].includes('WEBVTT')) i = 1;</p>
<p class="p1"><span class="Apple-converted-space">                </span>while (i &lt; lines.length &amp;&amp; lines[i].trim() === '') i++;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>while (i &lt; lines.length) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>let line = lines[i].trim();</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 跳过空行</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (line === '') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>i++;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>continue;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// SRT格式有序号行</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (format === 'srt' &amp;&amp; /^\d+$/.test(line)) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>i++;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>line = lines[i].trim();</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 解析时间轴</p>
<p class="p1"><span class="Apple-converted-space">                </span>const timeMatch = line.match(/(\d{2}:\d{2}:\d{2}.\d{3})\s*--&gt;\s*(\d{2}:\d{2}:\d{2}.\d{3})/);</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!timeMatch) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>i++;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>continue;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const startTime = timeMatch[1];</p>
<p class="p1"><span class="Apple-converted-space">                </span>const endTime = timeMatch[2];</p>
<p class="p1"><span class="Apple-converted-space">                </span>i++;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 收集字幕文本</p>
<p class="p1"><span class="Apple-converted-space">                </span>let text = '';</p>
<p class="p1"><span class="Apple-converted-space">                </span>while (i &lt; lines.length &amp;&amp; lines[i].trim() !== '') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>text += lines[i] + '\n';</p>
<p class="p1"><span class="Apple-converted-space">                    </span>i++;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>text = text.trim();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>if (text) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>subs.push({</p>
<p class="p1"><span class="Apple-converted-space">                        </span>id: subs.length + 1,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>startTime: startTime,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>endTime: endTime,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>text: text,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>originalText: text,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>originalStartTime: startTime,</p>
<p class="p1"><span class="Apple-converted-space">                        </span>originalEndTime: endTime</p>
<p class="p1"><span class="Apple-converted-space">                    </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>i++;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>return subs;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 显示字幕</p>
<p class="p1"><span class="Apple-converted-space">        </span>function displaySubtitles() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const container = document.getElementById('subtitleContainer');</p>
<p class="p1"><span class="Apple-converted-space">            </span>container.innerHTML = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>subtitles.forEach((sub, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const subDiv = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">                </span>subDiv.className = 'subtitle-item';</p>
<p class="p1"><span class="Apple-converted-space">                </span>subDiv.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;div class="time-display"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="text" class="time-input" value="${sub.startTime}"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                               </span>onchange="updateTime(${index}, 'start', this.value)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;span&gt;--&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">                        </span>&lt;input type="text" class="time-input" value="${sub.endTime}"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                               </span>onchange="updateTime(${index}, 'end', this.value)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>&lt;textarea class="subtitle-text"<span class="Apple-converted-space"> </span></p>
<p class="p1"><span class="Apple-converted-space">                              </span>onchange="updateText(${index}, this.value)"</p>
<p class="p1"><span class="Apple-converted-space">                              </span>onkeydown="handleTextKeydown(event, ${index})"</p>
<p class="p1"><span class="Apple-converted-space">                              </span>placeholder="在此输入字幕内容..."&gt;${sub.text}&lt;/textarea&gt;</p>
<p class="p1"><span class="Apple-converted-space">                </span>`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>container.appendChild(subDiv);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateStats();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 更新统计信息</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateStats() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('subtitleCount').textContent = subtitles.length;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (subtitles.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const totalMs = timeToMs(subtitles[subtitles.length - 1].endTime);</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('totalDuration').textContent = msToTime(totalMs);</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>document.getElementById('totalDuration').textContent = '00:00:00';</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>document.getElementById('modifiedCount').textContent = modifiedCount;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 时间转换函数</p>
<p class="p1"><span class="Apple-converted-space">        </span>function timeToMs(time) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const [hours, minutes, seconds] = time.split(':');</p>
<p class="p1"><span class="Apple-converted-space">            </span>const [secs, ms] = seconds.split('.');</p>
<p class="p1"><span class="Apple-converted-space">            </span>return parseInt(hours) * 3600000 + parseInt(minutes) * 60000 + parseInt(secs) * 1000 + parseInt(ms);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function msToTime(ms) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const hours = Math.floor(ms / 3600000);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const minutes = Math.floor((ms % 3600000) / 60000);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const seconds = Math.floor((ms % 60000) / 1000);</p>
<p class="p1"><span class="Apple-converted-space">            </span>return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 更新时间</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateTime(index, type, value) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!/^\d{2}:\d{2}:\d{2}\.\d{3}$/.test(value)) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert('时间格式错误！请使用 HH:MM:SS.MS 格式');</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (type === 'start') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>subtitles[index].startTime = value;</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>subtitles[index].endTime = value;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (subtitles[index].text !== subtitles[index].originalText ||</p>
<p class="p1"><span class="Apple-converted-space">                </span>subtitles[index].startTime !== subtitles[index].originalStartTime ||</p>
<p class="p1"><span class="Apple-converted-space">                </span>subtitles[index].endTime !== subtitles[index].originalEndTime) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>modifiedCount++;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateStats();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 更新文本</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateText(index, value) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>subtitles[index].text = value;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (value !== subtitles[index].originalText) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>modifiedCount++;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateStats();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 处理文本框按键事件（智能换行）</p>
<p class="p1"><span class="Apple-converted-space">        </span>function handleTextKeydown(event, index) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// 处理回车键</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (event.key === 'Enter' &amp;&amp; !event.shiftKey) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>event.preventDefault();</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const textarea = event.target;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const cursorPos = textarea.selectionStart;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const text = textarea.value;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const beforeCursor = text.substring(0, cursorPos);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const afterCursor = text.substring(cursorPos);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 计算换行位置比例</p>
<p class="p1"><span class="Apple-converted-space">                </span>const ratio = beforeCursor.length / text.length;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 更新当前字幕</p>
<p class="p1"><span class="Apple-converted-space">                </span>subtitles[index].text = beforeCursor.trim();</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 创建新字幕</p>
<p class="p1"><span class="Apple-converted-space">                </span>const newSub = {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>id: subtitles.length + 1,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>startTime: subtitles[index].startTime,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>endTime: subtitles[index].endTime,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>text: afterCursor.trim(),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>originalText: afterCursor.trim(),</p>
<p class="p1"><span class="Apple-converted-space">                    </span>originalStartTime: subtitles[index].startTime,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>originalEndTime: subtitles[index].endTime</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 插入新字幕</p>
<p class="p1"><span class="Apple-converted-space">                </span>subtitles.splice(index + 1, 0, newSub);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 重新分配时间轴</p>
<p class="p1"><span class="Apple-converted-space">                </span>const startMs = timeToMs(subtitles[index].startTime);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const endMs = timeToMs(subtitles[index].endTime);</p>
<p class="p1"><span class="Apple-converted-space">                </span>const duration = endMs - startMs;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>const splitPoint = startMs + duration * ratio;</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>subtitles[index].endTime = msToTime(splitPoint) + '.000';</p>
<p class="p1"><span class="Apple-converted-space">                </span>subtitles[index + 1].startTime = msToTime(splitPoint) + '.000';</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>displaySubtitles();</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 聚焦到新创建的字幕</p>
<p class="p1"><span class="Apple-converted-space">                </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const newTextarea = document.querySelectorAll('.subtitle-text')[index + 1];</p>
<p class="p1"><span class="Apple-converted-space">                    </span>if (newTextarea) {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>newTextarea.focus();</p>
<p class="p1"><span class="Apple-converted-space">                        </span>newTextarea.setSelectionRange(0, 0);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>}</p>
<p class="p1"><span class="Apple-converted-space">                </span>}, 100);</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>modifiedCount++;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// 下载字幕</p>
<p class="p1"><span class="Apple-converted-space">        </span>function downloadSubtitles() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const format = document.querySelector('input[name="format"]:checked').value;</p>
<p class="p1"><span class="Apple-converted-space">            </span>let content = '';</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>if (format === 'vtt') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>content = 'WEBVTT\n\n';</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>subtitles.forEach((sub, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (format === 'srt') {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>content += `${index + 1}\n`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><span class="Apple-converted-space">                </span></p>
<p class="p1"><span class="Apple-converted-space">                </span>content += `${sub.startTime} --&gt; ${sub.endTime}\n`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>content += `${sub.text}\n\n`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });</p>
<p class="p1"><span class="Apple-converted-space">            </span>const url = URL.createObjectURL(blob);</p>
<p class="p1"><span class="Apple-converted-space">            </span>const a = document.createElement('a');</p>
<p class="p1"><span class="Apple-converted-space">            </span>a.href = url;</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>let extension = format;</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (format === 'txt') extension = 'txt';</p>
<p class="p1"><span class="Apple-converted-space">            </span>else if (format === 'vtt') extension = 'vtt';</p>
<p class="p1"><span class="Apple-converted-space">            </span>else extension = 'srt';</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>a.download = `subtitles.${extension}`;</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.body.appendChild(a);</p>
<p class="p1"><span class="Apple-converted-space">            </span>a.click();</p>
<p class="p1"><span class="Apple-converted-space">            </span>document.body.removeChild(a);</p>
<p class="p1"><span class="Apple-converted-space">            </span>URL.revokeObjectURL(url);</p>
<p class="p2"><span class="Apple-converted-space">            </span></p>
<p class="p1"><span class="Apple-converted-space">            </span>alert('字幕下载成功！');</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
